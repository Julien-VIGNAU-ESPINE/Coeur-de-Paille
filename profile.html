<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Profil - C≈ìur de Paille</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="container page-profile animate-fade-in">
        <header class="top-bar">
            <h1>Mon Profil</h1>
            <div class="settings-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                    </path>
                </svg>
            </div>
        </header>

        <div class="profile-header-card">
            <div class="my-avatar" id="myAvatar"></div>
            <h2 id="myName">Chargement...</h2>
            <p id="myBio" class="my-bio">...</p>
        </div>

        <div class="menu-list">
            <div class="menu-item">
                <span class="icon">‚úèÔ∏è</span>
                <span>Modifier mon profil</span>
            </div>
            <div class="menu-item">
                <span class="icon">‚ù§Ô∏è</span>
                <span>Mes Matchs</span>
            </div>
            <div class="menu-item">
                <span class="icon">üõ°Ô∏è</span>
                <span>S√©curit√© & Confidentialit√©</span>
            </div>
        </div>

        <button class="btn btn-outline btn-logout" onclick="handleLogout()">
            Se d√©connecter
        </button>
    </div>

    <!-- Navigation -->
    <nav class="nav-bar">
        <a href="discovery.html" class="nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        </a>
        <a href="messages.html" class="nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path
                    d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                </path>
            </svg>
        </a>
        <a href="profile.html" class="nav-item active">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        </a>
    </nav>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script src="js/services/firebase-config.js"></script>
    <script src="js/services/mock-data.js"></script>
    <script src="js/services/api.js"></script>

    <script>
        // Inline JS for profile init
        document.addEventListener('DOMContentLoaded', async () => {
            // Check auth state
            if (window.api.useFirebase) {
                window.firebaseAuth.onAuthStateChanged(async (user) => {
                    if (user) {
                        // Fetch profile
                        try {
                            const doc = await window.firebaseDb.collection('profiles').doc(user.uid).get();
                            if (doc.exists) {
                                const data = doc.data();
                                document.getElementById('myName').innerText = data.name;
                                document.getElementById('myBio').innerText = data.bio || "Pas de bio";
                                document.getElementById('myAvatar').style.backgroundImage = `url('${data.image || "https://via.placeholder.com/150"}')`;
                            }
                        } catch (e) { console.error(e); }
                    } else {
                        // Redirect if not logged in? Optional for now.
                        document.getElementById('myName').innerText = "Non connect√©";
                    }
                });
            } else {
                // Mock
                document.getElementById('myName').innerText = "Jean (Test)";
                document.getElementById('myBio').innerText = "Ceci est un profil de test.";
                document.getElementById('myAvatar').style.backgroundImage = "url('https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-1.2.1&auto=format&fit=crop&w=634&q=80')";
            }
        });

        async function handleLogout() {
            if (confirm("Voulez-vous vraiment vous d√©connecter ?")) {
                await window.api.logout();
                window.location.href = 'index.html';
            }
        }
    </script>
</body>

</html>